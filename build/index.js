(()=>{"use strict";var a={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return a.d(s,{a:s}),s},d:(e,s)=>{for(var r in s)a.o(s,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:s[r]})},o:(a,e)=>Object.prototype.hasOwnProperty.call(a,e)};const e=window.wp.element,s=window.wp.components,r=window.wp.i18n,n=window.wp.apiFetch;var i=a.n(n);const t=window.ReactJSXRuntime;function l(a){if(!a)return"--:--";const e=Math.floor(Date.now()/1e3-a),s=Math.floor(e/60),r=e%60;return`${String(s).padStart(2,"0")}:${String(r).padStart(2,"0")}`}function c(a,e=0,s=!1){return"running"===a&&0===e?s?(0,r.__)("Preparing preview...","vmfa-ai-organizer"):(0,r.__)("Initializing...","vmfa-ai-organizer"):{idle:(0,r.__)("Ready","vmfa-ai-organizer"),running:(0,r.__)("Processing...","vmfa-ai-organizer"),completed:(0,r.__)("Completed","vmfa-ai-organizer"),cancelled:(0,r.__)("Cancelled","vmfa-ai-organizer"),failed:(0,r.__)("Failed","vmfa-ai-organizer")}[a]||a}function o({status:a,onCancel:e,onReset:n,isLoading:i}){const o="running"===a.status,m="completed"===a.status;return(0,t.jsxs)(s.Card,{className:"vmfa-scan-progress",children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsxs)("h3",{children:[o&&(0,t.jsx)(s.Spinner,{}),c(a.status,a.processed,a.dry_run),a.dry_run&&(0,t.jsx)("span",{className:"vmfa-badge vmfa-badge-info",children:(0,r.__)("Preview","vmfa-ai-organizer")})]})}),(0,t.jsxs)(s.CardBody,{children:[(0,t.jsxs)("div",{className:"vmfa-progress-info",children:[(0,t.jsxs)("div",{className:"vmfa-progress-row",children:[(0,t.jsx)("span",{className:"vmfa-progress-label",children:(0,r.__)("Mode:","vmfa-ai-organizer")}),(0,t.jsx)("span",{className:"vmfa-progress-value",children:(v=a.mode,{organize_unassigned:(0,r.__)("Organize Unassigned","vmfa-ai-organizer"),reanalyze_all:(0,r.__)("Re-analyze All","vmfa-ai-organizer"),reorganize_all:(0,r.__)("Reorganize All","vmfa-ai-organizer")}[v]||v)})]}),(0,t.jsxs)("div",{className:"vmfa-progress-row",children:[(0,t.jsx)("span",{className:"vmfa-progress-label",children:(0,r.__)("Progress:","vmfa-ai-organizer")}),(0,t.jsx)("span",{className:"vmfa-progress-value",children:0===a.processed&&o?(0,r.__)("Starting...","vmfa-ai-organizer"):`${a.processed} / ${a.total} (${a.percentage}%)`})]}),(0,t.jsx)("div",{className:"vmfa-progress-bar-container"+(o&&0===a.processed?" vmfa-progress-indeterminate":""),children:(0,t.jsx)("div",{className:"vmfa-progress-bar",style:{width:o&&0===a.processed?"100%":`${a.percentage}%`}})}),o&&0===a.processed&&(0,t.jsx)("div",{className:"vmfa-progress-hint",children:(0,r.__)("Connecting to AI provider and analyzing first batch... Initialization may take a couple of minutes.","vmfa-ai-organizer")}),o&&(0,t.jsxs)("div",{className:"vmfa-progress-row",children:[(0,t.jsx)("span",{className:"vmfa-progress-label",children:(0,r.__)("Elapsed:","vmfa-ai-organizer")}),(0,t.jsx)("span",{className:"vmfa-progress-value",children:l(a.started_at)})]}),m&&!a.dry_run&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"vmfa-progress-row",children:[(0,t.jsx)("span",{className:"vmfa-progress-label",children:(0,r.__)("Applied:","vmfa-ai-organizer")}),(0,t.jsx)("span",{className:"vmfa-progress-value vmfa-success",children:a.applied})]}),a.failed>0&&(0,t.jsxs)("div",{className:"vmfa-progress-row",children:[(0,t.jsx)("span",{className:"vmfa-progress-label",children:(0,r.__)("Failed:","vmfa-ai-organizer")}),(0,t.jsx)("span",{className:"vmfa-progress-value vmfa-error",children:a.failed})]})]}),a.error&&(0,t.jsx)("div",{className:"vmfa-progress-error",children:a.error})]}),(0,t.jsxs)("div",{className:"vmfa-progress-actions",children:[o&&(0,t.jsx)(s.Button,{variant:"secondary",isDestructive:!0,onClick:e,disabled:i,children:(0,r.__)("Cancel Scan","vmfa-ai-organizer")}),!o&&(0,t.jsx)(s.Button,{variant:"secondary",onClick:n,disabled:i,children:(0,r.__)("Start New Scan","vmfa-ai-organizer")})]}),a.results&&a.results.length>0&&(0,t.jsx)(d,{results:a.results})]})]});var v}function d({results:a}){const[s,n]=(0,e.useState)({}),i=[...a].reverse();return(0,t.jsxs)("div",{className:"vmfa-recent-results",children:[(0,t.jsxs)("h4",{children:[(0,r.__)("Recent Results","vmfa-ai-organizer")," (",a.length,")"]}),(0,t.jsx)("div",{className:"vmfa-results-list",children:i.map((a,e)=>(0,t.jsxs)("div",{className:`vmfa-result-item vmfa-result-${a.action}${s[e]?" is-expanded":""}`,children:[(0,t.jsxs)("button",{type:"button",className:"vmfa-result-header",onClick:()=>(a=>{n(e=>({...e,[a]:!e[a]}))})(e),"aria-expanded":s[e],children:[(0,t.jsx)("span",{className:"vmfa-result-action",children:m(a.action)}),(0,t.jsx)("span",{className:"vmfa-result-filename",title:a.filename||`#${a.attachment_id}`,children:a.filename||`#${a.attachment_id}`}),a.folder_name&&(0,t.jsxs)("span",{className:"vmfa-result-folder",children:["â†’ ",a.folder_name]}),(0,t.jsxs)("span",{className:"vmfa-result-confidence",children:[Math.round(100*(a.confidence||0)),"%"]}),(0,t.jsx)("span",{className:"vmfa-result-toggle",children:s[e]?"â–²":"â–¼"})]}),s[e]&&(0,t.jsx)("div",{className:"vmfa-result-details",children:(0,t.jsxs)("dl",{children:[(0,t.jsx)("dt",{children:(0,r.__)("Attachment ID:","vmfa-ai-organizer")}),(0,t.jsxs)("dd",{children:["#",a.attachment_id]}),(0,t.jsx)("dt",{children:(0,r.__)("Action:","vmfa-ai-organizer")}),(0,t.jsx)("dd",{children:v(a.action)}),a.folder_name&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("dt",{children:(0,r.__)("Folder:","vmfa-ai-organizer")}),(0,t.jsx)("dd",{children:a.folder_name})]}),a.new_folder_path&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("dt",{children:(0,r.__)("New Folder:","vmfa-ai-organizer")}),(0,t.jsx)("dd",{children:a.new_folder_path})]}),(0,t.jsx)("dt",{children:(0,r.__)("Confidence:","vmfa-ai-organizer")}),(0,t.jsxs)("dd",{children:[Math.round(100*(a.confidence||0)),"%"]}),(0,t.jsx)("dt",{children:(0,r.__)("Reason:","vmfa-ai-organizer")}),(0,t.jsx)("dd",{className:"vmfa-result-reason-text",children:a.reason||(0,r.__)("No reason provided","vmfa-ai-organizer")})]})})]},e))})]})}function m(a){switch(a){case"assign":return"ðŸ“";case"create":return"âž•";case"skip":return"â­ï¸";default:return"â“"}}function v(a){switch(a){case"assign":return(0,r.__)("Assign to existing folder","vmfa-ai-organizer");case"create":return(0,r.__)("Create new folder","vmfa-ai-organizer");case"skip":return(0,r.__)("Skipped","vmfa-ai-organizer");default:return a}}function f({results:a,onClose:e,onApply:n}){const i=a.reduce((a,e)=>(a[e.action]=a[e.action]||[],a[e.action].push(e),a),{assign:[],create:[],skip:[]}),l=i.assign.length,c=i.create.length,o=i.skip.length,d=[...new Set(i.create.map(a=>a.new_folder_path).filter(Boolean))].sort((a,e)=>a.localeCompare(e)),m=[...i.assign].sort((a,e)=>{const s=a.folder_name||a.new_folder_path||"",r=e.folder_name||e.new_folder_path||"";return s.localeCompare(r)});return(0,t.jsxs)(s.Modal,{title:(0,r.__)("Preview Changes","vmfa-ai-organizer"),onRequestClose:e,className:"vmfa-preview-modal",size:"large",children:[(0,t.jsxs)("div",{className:"vmfa-preview-content",children:[(0,t.jsxs)("div",{className:"vmfa-preview-summary",children:[(0,t.jsx)("h3",{children:(0,r.__)("Summary","vmfa-ai-organizer")}),(0,t.jsxs)("div",{className:"vmfa-preview-stats",children:[(0,t.jsxs)("div",{className:"vmfa-preview-stat",children:[(0,t.jsx)("span",{className:"vmfa-stat-value",children:l}),(0,t.jsx)("span",{className:"vmfa-stat-label",children:(0,r.__)("Will be assigned to existing folders","vmfa-ai-organizer")})]}),(0,t.jsxs)("div",{className:"vmfa-preview-stat",children:[(0,t.jsx)("span",{className:"vmfa-stat-value",children:c}),(0,t.jsx)("span",{className:"vmfa-stat-label",children:(0,r.__)("Will create new folders","vmfa-ai-organizer")})]}),(0,t.jsxs)("div",{className:"vmfa-preview-stat",children:[(0,t.jsx)("span",{className:"vmfa-stat-value",children:o}),(0,t.jsx)("span",{className:"vmfa-stat-label",children:(0,r.__)("No suitable folder found","vmfa-ai-organizer")})]})]})]}),d.length>0&&(0,t.jsxs)("div",{className:"vmfa-preview-section",children:[(0,t.jsx)("h4",{children:(0,r.__)("New Folders to Create","vmfa-ai-organizer")}),(0,t.jsx)("ul",{className:"vmfa-folder-list",children:d.map((a,e)=>(0,t.jsxs)("li",{className:"vmfa-folder-item",children:[(0,t.jsx)("span",{className:"vmfa-folder-icon",children:"ðŸ“"}),(0,t.jsx)("span",{className:"vmfa-folder-path",children:a})]},e))})]}),l>0&&(0,t.jsxs)("div",{className:"vmfa-preview-section",children:[(0,t.jsx)("h4",{children:(0,r.__)("Folder Assignments","vmfa-ai-organizer")}),(0,t.jsxs)("div",{className:"vmfa-preview-table-wrapper",children:[(0,t.jsxs)("table",{className:"vmfa-preview-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:(0,r.__)("Media ID","vmfa-ai-organizer")}),(0,t.jsx)("th",{children:(0,r.__)("Folder","vmfa-ai-organizer")}),(0,t.jsx)("th",{children:(0,r.__)("Confidence","vmfa-ai-organizer")}),(0,t.jsx)("th",{children:(0,r.__)("Reason","vmfa-ai-organizer")})]})}),(0,t.jsx)("tbody",{children:m.slice(0,20).map((a,e)=>{return(0,t.jsxs)("tr",{children:[(0,t.jsxs)("td",{children:["#",a.attachment_id]}),(0,t.jsx)("td",{children:a.folder_name||a.new_folder_path||"-"}),(0,t.jsx)("td",{children:(0,t.jsxs)("span",{className:(s=a.confidence,s>=.8?"vmfa-confidence-high":s>=.5?"vmfa-confidence-medium":"vmfa-confidence-low"),children:[Math.round(100*a.confidence),"%"]})}),(0,t.jsx)("td",{children:a.reason})]},e);var s})})]}),m.length>20&&(0,t.jsx)("p",{className:"vmfa-preview-more",children:(0,r.__)(`And ${m.length-20} more...`,"vmfa-ai-organizer")})]})]}),o>0&&(0,t.jsxs)("div",{className:"vmfa-preview-section vmfa-preview-skipped",children:[(0,t.jsx)("h4",{children:(0,r.__)("Skipped Items","vmfa-ai-organizer")}),(0,t.jsx)("p",{className:"description",children:(0,r.__)("These items could not be matched to any folder.","vmfa-ai-organizer")}),(0,t.jsx)("ul",{className:"vmfa-skipped-list",children:i.skip.slice(0,10).map((a,e)=>(0,t.jsxs)("li",{children:["#",a.attachment_id,": ",a.reason]},e))}),o>10&&(0,t.jsx)("p",{className:"vmfa-preview-more",children:(0,r.__)(`And ${o-10} more...`,"vmfa-ai-organizer")})]})]}),(0,t.jsxs)("div",{className:"vmfa-preview-actions",children:[(0,t.jsx)(s.Button,{variant:"primary",onClick:n,disabled:0===l&&0===c,children:(0,r.__)("Apply Changes","vmfa-ai-organizer")}),(0,t.jsx)(s.Button,{variant:"secondary",onClick:e,children:(0,r.__)("Cancel","vmfa-ai-organizer")})]})]})}function h({onRestore:a}){const[n,l]=(0,e.useState)(null),[c,o]=(0,e.useState)(!0),[d,m]=(0,e.useState)(!1),[v,f]=(0,e.useState)(null),[h,u]=(0,e.useState)(!1),p=async()=>{try{const a=await i()({path:"/vmfa/v1/backup",method:"GET"});l(a)}catch(a){console.error("Failed to fetch backup info:",a)}finally{o(!1)}};return(0,e.useEffect)(()=>{p()},[]),c||!n?.exists?null:(0,t.jsxs)(s.Card,{className:"vmfa-restore-panel",children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)("h3",{children:(0,r.__)("Backup & Restore","vmfa-ai-organizer")})}),(0,t.jsxs)(s.CardBody,{children:[v&&(0,t.jsx)(s.Notice,{status:v.type,isDismissible:!0,onRemove:()=>f(null),children:v.message}),(0,t.jsxs)("div",{className:"vmfa-backup-info",children:[(0,t.jsx)("p",{children:(0,t.jsx)("strong",{children:(0,r.__)("Backup Available","vmfa-ai-organizer")})}),(0,t.jsxs)("div",{className:"vmfa-backup-details",children:[(0,t.jsxs)("div",{className:"vmfa-backup-row",children:[(0,t.jsx)("span",{className:"vmfa-backup-label",children:(0,r.__)("Created:","vmfa-ai-organizer")}),(0,t.jsx)("span",{className:"vmfa-backup-value",children:(g=n.timestamp,g?new Date(1e3*g).toLocaleString():"-")})]}),(0,t.jsxs)("div",{className:"vmfa-backup-row",children:[(0,t.jsx)("span",{className:"vmfa-backup-label",children:(0,r.__)("Folders:","vmfa-ai-organizer")}),(0,t.jsx)("span",{className:"vmfa-backup-value",children:n.folder_count})]}),(0,t.jsxs)("div",{className:"vmfa-backup-row",children:[(0,t.jsx)("span",{className:"vmfa-backup-label",children:(0,r.__)("Assignments:","vmfa-ai-organizer")}),(0,t.jsx)("span",{className:"vmfa-backup-value",children:n.assignment_count})]})]})]}),h?(0,t.jsxs)("div",{className:"vmfa-restore-confirm",children:[(0,t.jsx)("p",{className:"vmfa-restore-warning",children:(0,r.__)("This will replace all current folders and assignments with the backup. Are you sure?","vmfa-ai-organizer")}),(0,t.jsxs)("div",{className:"vmfa-restore-actions",children:[(0,t.jsx)(s.Button,{variant:"secondary",onClick:()=>u(!1),disabled:d,children:(0,r.__)("Cancel","vmfa-ai-organizer")}),(0,t.jsx)(s.Button,{variant:"primary",isDestructive:!0,onClick:async()=>{m(!0),f(null);try{const e=await i()({path:"/vmfa/v1/restore",method:"POST"});f({type:"success",message:(0,r.__)(`Restored ${e.folders_restored} folders and ${e.assignments_restored} assignments.`,"vmfa-ai-organizer")}),u(!1),a&&a(),await p()}catch(a){f({type:"error",message:a.message||(0,r.__)("Failed to restore backup.","vmfa-ai-organizer")})}finally{m(!1)}},isBusy:d,disabled:d,children:(0,r.__)("Yes, Restore Backup","vmfa-ai-organizer")})]})]}):(0,t.jsxs)("div",{className:"vmfa-restore-actions",children:[(0,t.jsx)(s.Button,{variant:"secondary",onClick:()=>u(!0),children:(0,r.__)("Restore Backup","vmfa-ai-organizer")}),(0,t.jsx)(s.Button,{variant:"link",isDestructive:!0,onClick:async()=>{try{await i()({path:"/vmfa/v1/backup",method:"DELETE"}),l({exists:!1}),f({type:"info",message:(0,r.__)("Backup deleted.","vmfa-ai-organizer")})}catch(a){f({type:"error",message:a.message||(0,r.__)("Failed to delete backup.","vmfa-ai-organizer")})}},children:(0,r.__)("Delete Backup","vmfa-ai-organizer")})]})]})]});var g}function u(){const[a,n]=(0,e.useState)("organize_unassigned"),[l,c]=(0,e.useState)(!0),[d,m]=(0,e.useState)(null),[v,u]=(0,e.useState)(!1),[g,_]=(0,e.useState)([]),[x,j]=(0,e.useState)(null),{status:z,isLoading:y,error:w,startScan:N,cancelScan:b,resetScan:C,applyCachedResults:k,refresh:S}=function(a=2e3){const[s,r]=(0,e.useState)({status:"idle",mode:"",dry_run:!1,total:0,processed:0,percentage:0,applied:0,failed:0,results:[],started_at:null,completed_at:null,error:null}),[n,t]=(0,e.useState)(!0),[l,c]=(0,e.useState)(null),o=(0,e.useRef)(null),d=(0,e.useCallback)(async()=>{try{const a=await i()({path:"/vmfa/v1/scan/status",method:"GET"});r(a),c(null)}catch(a){c(a.message||"Failed to fetch scan status")}finally{t(!1)}},[]);(0,e.useEffect)(()=>(d(),"running"===s.status&&(o.current=setInterval(d,a)),()=>{o.current&&clearInterval(o.current)}),[s.status,d,a]);const m=(0,e.useCallback)(async(a,e=!1)=>{try{t(!0);const s=await i()({path:"/vmfa/v1/scan",method:"POST",data:{mode:a,dry_run:e}});return await d(),s}catch(a){throw c(a.message||"Failed to start scan"),a}finally{t(!1)}},[d]),v=(0,e.useCallback)(async()=>{try{t(!0);const a=await i()({path:"/vmfa/v1/scan/cancel",method:"POST"});return await d(),a}catch(a){throw c(a.message||"Failed to cancel scan"),a}finally{t(!1)}},[d]),f=(0,e.useCallback)(async()=>{try{t(!0);const a=await i()({path:"/vmfa/v1/scan/reset",method:"POST"});return await d(),a}catch(a){throw c(a.message||"Failed to reset scan"),a}finally{t(!1)}},[d]),h=(0,e.useCallback)(async a=>{try{t(!0);const e=await i()({path:"/vmfa/v1/scan/apply-cached",method:"POST",data:{mode:a}});return await d(),e}catch(a){throw c(a.message||"Failed to apply cached results"),a}finally{t(!1)}},[d]),u=(0,e.useCallback)(async()=>{try{return(await i()({path:"/vmfa/v1/scan/cached-count",method:"GET"})).count}catch(a){return c(a.message||"Failed to get cached count"),0}},[]);return{status:s,isLoading:n,error:l,startScan:m,cancelScan:v,resetScan:f,applyCachedResults:h,getCachedCount:u,refresh:d}}();(0,e.useEffect)(()=>{F()},[]),(0,e.useEffect)(()=>{"completed"===z.status&&z.dry_run&&R()},[z.status,z.dry_run]);const R=async()=>{try{const a=await i()({path:"/vmfa/v1/scan/cached-results",method:"GET"});_(a.results||[]),u(!0)}catch(a){console.error("Failed to fetch cached results:",a),_(z.results||[]),u(!0)}},F=async()=>{try{const a=await i()({path:"/vmfa/v1/stats",method:"GET"});m(a)}catch(a){console.error("Failed to fetch stats:",a)}},B=async()=>{try{await C(),await F(),j(null)}catch(a){j({type:"error",message:a.message||(0,r.__)("Failed to reset.","vmfa-ai-organizer")})}},A="running"===z.status,E="completed"===z.status,L="cancelled"===z.status,P=[{label:(0,r.__)("Organize Unassigned","vmfa-ai-organizer"),value:"organize_unassigned"},{label:(0,r.__)("Re-analyze All","vmfa-ai-organizer"),value:"reanalyze_all"},{label:(0,r.__)("Reorganize All (Reset & Rebuild)","vmfa-ai-organizer"),value:"reorganize_all"}];return(0,t.jsxs)("div",{className:"vmfa-ai-organizer-panel",children:[x&&(0,t.jsx)(s.Notice,{status:x.type,isDismissible:!0,onRemove:()=>j(null),children:x.message}),w&&(0,t.jsx)(s.Notice,{status:"error",isDismissible:!1,children:w}),d&&(0,t.jsxs)(s.Card,{className:"vmfa-stats-card",children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)("h3",{children:(0,r.__)("Media Library Statistics","vmfa-ai-organizer")})}),(0,t.jsx)(s.CardBody,{children:(0,t.jsxs)("div",{className:"vmfa-stats-grid",children:[(0,t.jsxs)("div",{className:"vmfa-stat",children:[(0,t.jsx)("span",{className:"vmfa-stat-value",children:d.total_media}),(0,t.jsx)("span",{className:"vmfa-stat-label",children:(0,r.__)("Total Media","vmfa-ai-organizer")})]}),(0,t.jsxs)("div",{className:"vmfa-stat",children:[(0,t.jsx)("span",{className:"vmfa-stat-value",children:d.assigned}),(0,t.jsx)("span",{className:"vmfa-stat-label",children:(0,r.__)("In Folders","vmfa-ai-organizer")})]}),(0,t.jsxs)("div",{className:"vmfa-stat",children:[(0,t.jsx)("span",{className:"vmfa-stat-value",children:d.unassigned}),(0,t.jsx)("span",{className:"vmfa-stat-label",children:(0,r.__)("Unassigned","vmfa-ai-organizer")})]}),(0,t.jsxs)("div",{className:"vmfa-stat",children:[(0,t.jsx)("span",{className:"vmfa-stat-value",children:d.folders}),(0,t.jsx)("span",{className:"vmfa-stat-label",children:(0,r.__)("Folders","vmfa-ai-organizer")})]})]})})]}),!A&&(0,t.jsxs)(s.Card,{className:"vmfa-scan-controls",children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsx)("h3",{children:(0,r.__)("Scan Options","vmfa-ai-organizer")})}),(0,t.jsxs)(s.CardBody,{children:[(0,t.jsx)(s.RadioControl,{label:(0,r.__)("Scan Mode","vmfa-ai-organizer"),help:p(a),selected:a,options:P,onChange:n}),"reorganize_all"===a&&(0,t.jsx)(s.Notice,{status:"warning",isDismissible:!1,children:(0,r.__)("Warning: This will remove all existing folder assignments and reorganize from scratch. A backup will be created automatically.","vmfa-ai-organizer")}),(0,t.jsx)(s.CheckboxControl,{label:(0,r.__)("Preview mode (dry run)","vmfa-ai-organizer"),help:(0,r.__)("Show proposed changes without applying them.","vmfa-ai-organizer"),checked:l,onChange:c}),(0,t.jsxs)("div",{className:"vmfa-scan-actions",children:[(0,t.jsx)(s.Button,{variant:"primary",onClick:async()=>{try{j(null),await N(a,l),j({type:"success",message:l?(0,r.__)("Preview scan started. Results will be shown when complete. You can leave this page and return later.","vmfa-ai-organizer"):(0,r.__)("Scan started. Media files are being organized. You can leave this page and return later.","vmfa-ai-organizer")})}catch(a){j({type:"error",message:a.message||(0,r.__)("Failed to start scan.","vmfa-ai-organizer")})}},disabled:y||"organize_unassigned"===a&&0===d?.unassigned,children:l?(0,r.__)("Preview Changes","vmfa-ai-organizer"):(0,r.__)("Start Organizing","vmfa-ai-organizer")}),(E||L)&&(0,t.jsx)(s.Button,{variant:"secondary",onClick:B,disabled:y,children:(0,r.__)("Reset","vmfa-ai-organizer")})]})]})]}),(A||E||L)&&(0,t.jsx)(o,{status:z,onCancel:async()=>{try{await b(),j({type:"info",message:(0,r.__)("Scan cancelled.","vmfa-ai-organizer")})}catch(a){j({type:"error",message:a.message||(0,r.__)("Failed to cancel scan.","vmfa-ai-organizer")})}},onReset:B,isLoading:y}),(0,t.jsx)(h,{onRestore:()=>{F(),S()}}),v&&(0,t.jsx)(f,{results:g,onClose:()=>u(!1),onApply:async()=>{u(!1);try{j({type:"info",message:(0,r.__)("Applying cached preview results...","vmfa-ai-organizer")});const e=await k(a);await F(),j({type:"success",message:e.message||(0,r.__)("Preview results applied successfully.","vmfa-ai-organizer")})}catch(a){j({type:"error",message:a.message||(0,r.__)("Failed to apply preview results.","vmfa-ai-organizer")})}}})]})}function p(a){switch(a){case"organize_unassigned":return(0,r.__)("Only process media files that are not already in a folder.","vmfa-ai-organizer");case"reanalyze_all":return(0,r.__)("Re-analyze all media and suggest new folder assignments.","vmfa-ai-organizer");case"reorganize_all":return(0,r.__)("Remove all folders and assignments, then create a new AI-optimized structure.","vmfa-ai-organizer");default:return""}}function g(a){document.querySelectorAll(".vmfa-provider-field").forEach(e=>{const s=e.closest("tr");s&&(s.classList.add("vmfa-provider-row"),e.dataset.provider===a?s.classList.add("vmfa-provider-active"):s.classList.remove("vmfa-provider-active"))}),"openai"===a&&_()}function _(){const a=document.getElementById("vmfa_openai_type");if(!a)return;const e="azure"===a.value;document.querySelectorAll(".vmfa-azure-field").forEach(a=>{const s=a.closest("tr");s&&(s.classList.add("vmfa-azure-row"),e?s.classList.add("vmfa-azure-active"):s.classList.remove("vmfa-azure-active"))})}function x(){const a=document.getElementById("vmfa_ai_provider");a&&(g(a.value),a.addEventListener("change",a=>{g(a.target.value)}));const e=document.getElementById("vmfa_openai_type");e&&e.addEventListener("change",()=>{_()})}function j(){const a=document.getElementById("vmfa-ai-organizer-scanner");a&&(0,e.createRoot)(a).render((0,t.jsx)(u,{}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{x(),j()}):(x(),j())})();